# multi-line script used to build the project
components:
    runtime: 
        script: |
            call ./build.sh clr+libs -c Release -runtimeconfiguration Release -arch x64
            call ./src/tests/build.sh Release x64 generatelayoutonly /p:LibrariesConfiguration=Release
            rm -rf ./artifacts/tests/coreclr/Linux.x64.Release/tests/Core_Root/*.pdb

        arguments: '--{{job}}.options.outputFiles ./artifacts/tests/coreclr/Linux.x64.Release/tests/Core_Root/'

# default arguments that are always used on crank commands
defaults: '--{{job}}.framework net7.0 --relay AZURE_RELAY'

variables:
    job: client
    httpclientcommon: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/httpclient.benchmarks.yml --server.framework net7.0 --variable useHttps=true --variable concurrencyPerHttpClient=100

# the first value is the default if none is specified
profiles:

    aspnet-citrine-lin:
        description: Intel/Linux 28 Cores
        arguments: --profile aspnet-citrine-lin-relay

    aspnet-perf-lin:
        description: Intel/Linux 12 Cores
        arguments: --profile aspnet-perf-lin-relay

    aspnet-citrine-amd:
        description: Amd/Linux 48 Cores
        arguments: --profile aspnet-citrine-amd-relay

benchmarks:
    plaintext:
      description: TechEmpower Plaintext Scenario - ASP.NET Platform implementation
      arguments: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/platform.benchmarks.yml --scenario plaintext
      variables:
          job: application

    json:
      description: TechEmpower JSON Scenario - ASP.NET Platform implementation
      arguments: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/platform.benchmarks.yml --scenario json
      variables:
          job: application
    
    fortunes:
      description: TechEmpower Fortunes Scenario - ASP.NET Platform implementation
      arguments: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/platform.benchmarks.yml --scenario fortunes
      variables:
          job: application

    httpclient-h1-get:
      description: HttpClient HTTP/1.1 GET
      arguments: '{{httpclientcommon}} --scenario httpclient-kestrel-get --variable httpVersion="1.1" --variable responseSize=8192'

    httpclient-h2-get:
      description: HttpClient HTTP/2.0 GET
      arguments: '{{httpclientcommon}} --scenario httpclient-kestrel-get --variable httpVersion="2.0" --variable responseSize=8192'

    httpclient-h3-get:
      description: HttpClient HTTP/3.0 GET
      arguments: '{{httpclientcommon}} --scenario httpclient-kestrel-get --variable httpVersion="3.0" --variable responseSize=8192'

    httpclient-h1-post:
      description: HttpClient HTTP/1.1 POST
      arguments: '{{httpclientcommon}} --scenario httpclient-kestrel-post --variable httpVersion="1.1" --variable requestContentSize=8192'

    httpclient-h2-post:
      description: HttpClient HTTP/2.0 POST
      arguments: '{{httpclientcommon}} --scenario httpclient-kestrel-post --variable httpVersion="2.0" --variable requestContentSize=8192'

    httpclient-h3-post:
      description: HttpClient HTTP/3.0 POST
      arguments: '{{httpclientcommon}} --scenario httpclient-kestrel-post --variable httpVersion="3.0" --variable requestContentSize=8192'
